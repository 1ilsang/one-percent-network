# Chapter 4. 액세스 회선을 통해 인터넷의 내부로

> 액세스 회선과 프로바이더의 탐험

1. ADSL 기술을 이용한 액세스 회선의 구조와 동작

2. 광섬유를 이용한 액세스 회선(FTTH)액세스 회선으로 이용하는 PPP와 터널링

4. 프로바이더 내부

5. 프로바이더를 경유하여 흐르는 패킷



---



## ADSL 기술을 이용한 액세스 회선의 구조와 동작

스위칭 허브와 라우터로 패킷을 중계하면 패킷은 목적지 서버를 향해 진행한다. 그리고 인터넷 접속용 라우터를 경유하여 인터넷으로 나가게 되는데, 이 부분부터 시작한다.

먼저, **ADSL** 이 무엇인지 알 필요가 있다.

- 전화선을 이용하여 컴퓨터가 데이터 통신을 할 수 있는 통신 수단을 말한다. 인터넷이 발달하기 전 전화선은 이미 전국으로 설치가 되었기 때문에 이 선들을 이용해서 데이터 통신을 하는 것을 ADSL이라고 한다.



![image](https://user-images.githubusercontent.com/46305139/98098252-71bad580-1ed1-11eb-94a7-e684e69e3f19.png)



**인터넷 접속용 라우터**

MAC 헤더, PPPoE 헤더, PPP 헤더 세가지를 붙이고 ADSL 모뎀에 패킷을 보낸다 (PPPoE)

MAC 주소

- 모뎀에 전송을 하기 위함

PPPoE, PPP

- 인증과 관련된 헤더



**ADSL 모뎀**

수신한 패킷을 이용해 [ATM](https://en.wikipedia.org/wiki/Asynchronous_Transfer_Mode) 인터페이스 셀로 분할하고, 전기 신호로 바꾸에 스플리터에 송신한다



**스플리터**

ADSL의 신호는 전화의 음성 신호와 섞여서 전화 회선에 함께 흘러나간다. 스플리터는 주파수차이를 이용하여, 전화 신호와 ADSL의 신호를 나누는 역할을 한다



**DSLAM(DSL Access Multiplexer)**

> 전화국용 ADSL 집합 모뎀으로 다수의 ADSL 모뎀

전기 신호를 수신하고, 디지털 데이터의 셀로 복원하여, BAS에 송신



**BAS(Broadband Access Server)**

> 패킷 중계 장치

셀로 분할된 패킷을 원래 패킷으로 복원한다. MAC 헤더와 PPPoE 헤더는 BAS 인터페이스에 패킷을 건네주기 위한 역할이므로 제거한다. 터널링용 헤더를 붙여 터널링 라우터로 송신



**터널링용 라우터**

터널링용 헤더를 분리하고 IP 패킷을 추출하여 인터넷의 내부에 중계





## 광섬유를 이용한 액세스 회선(FTTH)

<img src="https://user-images.githubusercontent.com/46305139/98021493-b8fc8400-1e47-11eb-8b11-564a7457c770.png" alt="image" style="zoom:50%;" />

![image](https://user-images.githubusercontent.com/46305139/98022097-8606c000-1e48-11eb-86eb-6ba66f0a330d.png)

ADSL 와 같은 데이터 통신을 하기 위한 방법이다. [FTTH](https://ko.wikipedia.org/wiki/FTTH)는 광섬유를 이용하는 방식이며 빛을 이용하여 데이터를 전송한다. (밝으면 1, 어두우면 0)



**싱글모드와 멀티모드**

*싱글모드*

- 코어에 1개의 빛을 이용하는  방식이다.
- 거리가 먼 경우(건물과 건물 사이를 연결할 때)에 사용한다. 거리가 멀어 지면, 신호의 변형이 일어나기 쉬우므로 싱글모드를 사용한다
- FTTH는 싱글모드를 사용한다

*멀티 모드*

- 코어에 2개 이상의 빛을 이용하는 방식이다.
- 더 많은 데이터를 사용할수 있어 데이터 처리 속도가 빠르다



## 액세스 회선으로 이용하는 PPP와 터널링

ADSL 이나 FTTH 등의 액세스 회선에서 인터넷을 향해 흘러온 패킷은 액세스 회선을 운영하는 사업자가 소유한 BAS에 도착한다.



**인증**

*PPP(Point-to-Point Protocol)* 

> 두 지점간에 1대 1 통신을 수행하는 프로토콜, 사용자 인증 기능이 잇음.

PPP 순서

1. (송신측) 통신을 하지 않을때 상대에게 통신요청을 보냄

2. (송수신측양쪽) 접속할 자격을 가지고 있는 사용자인지 확인(사용자 인증)

3. (송수신측양쪽) 통신 조건에 대해 상담

4. (송수신측양쪽) 통신을 시작



PPP의 사용

주로 전화선을 이용하여 인터넷 접속시에 사용



접속 순서

1. 클라이언트는 ISP(Internet Service Provider)의  액세스 지점에 전화를 걸고 회선이 연결되면 PPP로 통신을 시작

2. 클라이언트는 모뎀 포트에 전화선을 연결

3. 모뎀은 클라이언트에서 오는 디지털파를 아날로그파로 변환하여 전화교환기로 전달

4. 전화교환기는 인터넷에 접속하는 시간만큼 전화요금을 기록하며 ISP가 있는 지점의 모뎀으로 아날로그파를 전달

5. 모뎀은 아날로그파를 다시 디지털파로 변환하여 ISP의 액세스 서버로 전달

6. ISP 액세스 서버는 사용자 인증을 실시

7. ISP 액세스 서버와 여러 라우터를 경유하여 인터넷에 접속 



*PPPoE(PPP over Ethernet)* 

> 이더넷에 인증 기능을 추가한 프로토콜

이더넷 상의 두 컴퓨터 간에 인증을 수행 할 수 있도록 한것. 

PPPoE의 순서

1. PPPoE로 통신상대와 연결

2. PPP를 사용하고, 사용자 인증 등을 수행합니다.

3. 통신을 시작합니다.



**터널링**

BAS에는 터널링이라는 개념을 사용하여 패킷을 운반하는 기능도 있다. 프로바이더의 라우터 사이에 있는 ADSL/FTTH 접속 서비스 사업자의 네트워크 안에 터널을 만든다

*터널링 실현 방식* 

1. TCP 커넥션
   - 네트워크의 터널링용 라우터 사이에 TCP 커넥션을 만든다. 커넥션의 양끝에 있는 소켓에 해당하는 부분을 라우터의 포트로 간주하고 패킷을 송수신한다
2. 캡슐화 방식
   - 헤더를 포함한 패킷 전체를 별도의 패킷 안에 저장하여 터널의 한쪽 출입구까지 운반한다



**액세스 회선 전체 동작**

1. 인터넷 라우터 설치
2. 인터넷 접속용 라우터에 사용자명과 패스워드 할당
3. PPPoE를 기반으로 BAS를 찾는다 - BAS의 MAC 주소를 찾는다
4. BAS에 사용자명과 패스워드를 보낸다
5. BAS에서 패스워드 확인 후 사용자에 대해 TCP/IP 정보를 통지 - 기기에 할당한 IP 주소, DNS 서버의 IP 주소, 기본 게이트웨이 IP 주소
6. 인터넷 접속용 라우터에서 이 정보를 바탕으로 라우터 자체에 설정 - BAS측 포트에 글로벌 주소 할당, 라우팅 테이블에 기본 게이트웨이 설정
7. 인터넷 사용



## 프로바이더의 내부

**POP**

> Point Of Presence

인터넷은 한 개의 조직이 운영 관리하는 단일 네트워크가 아니라 다수의 프로바이더의 네트워크를 서로 접속한 것이다. ADSL이나 FTTH의 액세스 회선은 **사용자가 계약한 프로바이더의 설비**에 연결되어 있는데, 이 설비를 POP라고 부른다

여러 유형의 라우터가 여기에 설치되어 있다.



**NOC**

> Network Operation Center

프로바이더의 핵심이 돼는 설비로서 POP 에서 들어온 패킷이 여기에 모여든다. 고성능 라우터가 설치되어있다. (Tb/sec)



## 프로바이더를 경유하여 흐르는 패킷

POP의 라우터에 도착한 패킷의 움직임을 살펴보자.

1. **웹 서버가 클라이언트와 같은 프로바이더에 접속되어 있는 경우**

프로바이더의 라우터에는 라우터끼리 경로 정보를 교환하고 라우팅 테이블에 자동으로 등록한다. 이를 통해 중계 대상을 알 수 있다.

프로바이더의 라우터에서 중계 대상들을 파악하여 라우터들을 통해 웹서버로 향한다. POP -> NOC or POP -> ... -> 웹 서버측의 POP의 라우터 -> 웹서버



2. **서버측의 프로바이더가 클라이언트 측과 다른 경우**

패킷을 서버측의 프로바이더로 보내야한다. 이 때의 중계대상도 라우팅 테이블에 등록되어있다. - 프로바이더는 다른 프로바이더와도 경로 정보를 교환한다.



결국, 인터넷의 라우터에는 최종 목적지가 동일 프로바이더인지, 다른 프로바이더인지 상관 없이 모든 경로가 등록되어 있다.



**프로바이더끼리 경로 정보 교환**



**BGP**

> Border Gateway Protocol

 인터넷에서 프로바이더간 라우팅 및 도달 가능성 정보를 교환하기 위해 설계된, 표준화된 외부 게이트웨이 프로토콜의 하나이다. 이 BGP를 사용하여 라우팅 정보를 교환한다.



경로 정보 교환을 통지하는 방식

1. 트랜지트(transit)

접속 상대에게 전체 경로를 통지한다

2. 피어(직접 접속)

자신에게 직접 접속되어 있는 네트워크에 대한 경로 정보만 상대에게 통지한다

3. 피어(IX 경유)

프로바이더와 집적 1대1 형태로 접속하는 방법밖에 없으면 모든 프로바이더와 통신회선을 연결해야 한다. 이를 해결하기 위해 중심이 되는 IX(Internet eXchange Point) 를 설치하고 이것을 경유하여 접속한다.





